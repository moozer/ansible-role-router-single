{# inspiration from http://www.openbsd.dk/faq/pf/example1.html #}
# macros

#int_if="{{ NAT_inside | join(' ') }}"
#int_if="em1"

#tcp_services="{ 22 }"
icmp_types="echoreq"

# options

set block-policy return
set loginterface egress
set skip on lo

## FTP Proxy rules
#
#anchor "ftp-proxy/*"
#pass in quick on $LAN_A inet proto tcp to any port ftp \
#    divert-to 127.0.0.1 port 8021

# match rules

match out on egress inet from !(egress:network) to any nat-to (egress:0)

# filter rules

block in log
pass out quick

antispoof quick for { lo {{ NAT_inside | join(' ') }} }

# no internet facing services
#pass in on egress inet proto tcp from any to (egress) \
#    port $tcp_services

{% if mgnt_if is defined %}
# always allow ssh on management interface
pass in on {{ mgnt_if }} inet proto tcp from any to port 22
{% endif %}

{% if forward_list is defined %}
{% for rdr in forward_list %}
pass in on egress inet proto tcp  \
    to (egress) port {{ rdr.srcport }}  \
    rdr-to {{ rdr.hostip }} port {{ rdr.dstport }}
{% endfor %}
{% else %}
# no forwarding rules
{% endif %}

pass in inet proto icmp all icmp-type $icmp_types

{% for iface in NAT_inside %}
pass in on {{ iface }}
{% endfor %}
